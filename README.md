# SQL Редактор - Система для навчання SQL

## Огляд проекту

Цей проект представляє собою веб-додаток для навчання SQL, який дозволяє викладачам створювати завдання з SQL, а студентам - виконувати ці завдання та отримувати зворотній зв'язок. Система включає SQL редактор, тимчасові бази даних для кожного користувача, та можливість порівняння відповідей студентів з еталонними відповідями викладачів.

## Як запустити проект

### Вимоги

- PostgreSQL
- Python 3.8+
- Node.js 14+
- Django
- React

### Кроки для запуску

1. **Бекенд**:
   ```bash
   cd backend
   python -m venv .venv
   .venv\Scripts\activate
   pip install -r requirements.txt
   python manage.py migrate
   python manage.py runserver
   ```

2. **Фронтенд**:
   ```bash
   cd frontend
   npm install
   npm start
   ```

## Тимчасові бази даних для SQL редактора

### Огляд

Коли користувач вибирає базу даних викладача в SQL редакторі, для цього користувача створюється тимчасова база даних PostgreSQL. Ця база даних заповнюється вмістом SQL-дампу, завантаженого викладачем. Тимчасова база даних використовується для всіх SQL-запитів та отримання схеми під час сесії, і автоматично видаляється після закінчення сесії користувача.

### Як це працює

1. **Вибір бази даних**: Коли користувач вибирає базу даних викладача в SQL редакторі, система перевіряє, чи існує вже тимчасова база даних для цього користувача та бази даних.

2. **Створення бази даних**: Якщо тимчасової бази даних не існує, створюється нова база даних PostgreSQL з унікальним ім'ям. SQL-дамп, пов'язаний з базою даних викладача, виконується для заповнення тимчасової бази даних.

3. **Виконання запитів**: Всі SQL-запити виконуються в тимчасовій базі даних, забезпечуючи кожному користувачу ізольоване середовище.

4. **Отримання схеми**: При отриманні схеми бази даних система використовує тимчасову базу даних для отримання списку таблиць та їх стовпців.

5. **Очищення**: Коли сесія користувача закінчується (наприклад, коли він виходить з системи або його сесія закінчується), тимчасова база даних автоматично видаляється.

### Технічні вимоги

- PostgreSQL сервер з правами на створення та видалення баз даних
- Django з увімкненим управлінням сесіями
- Пакет Python psycopg2 для підключення до PostgreSQL

## SQL-дампи для SQL редактора

### Сумісні формати баз даних

SQL редактор розроблений для роботи з дампами баз даних **PostgreSQL**. Коли ви завантажуєте файл SQL-дампу, він буде виконаний у тимчасовій базі даних PostgreSQL, створеній спеціально для вашої сесії.

### Вимоги до файлів SQL-дампу

1. **Формат**: Файл повинен бути дійсним SQL-дампом PostgreSQL, що містить SQL-інструкції, які можуть бути виконані в базі даних PostgreSQL.

2. **Вміст**: Файл повинен містити:
   - Інструкції створення таблиць (`CREATE TABLE`)
   - Інструкції вставки даних (`INSERT INTO`)
   - Будь-які інші SQL-інструкції, сумісні з PostgreSQL

3. **Кодування**: Файл повинен бути закодований в UTF-8.

### Обмеження

Поточна реалізація має такі обмеження:

1. **Тільки синтаксис PostgreSQL**: Система очікує синтаксис PostgreSQL. SQL-дампи з інших систем баз даних (наприклад, MySQL, SQL Server тощо) можуть не працювати коректно без ручних модифікацій.

2. **Немає автоматичного перетворення**: Немає автоматичного перетворення з інших діалектів SQL в синтаксис PostgreSQL.

3. **Обмеження розміру**: Дуже великі SQL-дампи можуть довго оброблятися або перевищувати ліміти системних ресурсів.

### Як створити сумісні SQL-дампи

#### З PostgreSQL

Щоб створити сумісний SQL-дамп з існуючої бази даних PostgreSQL, використовуйте команду `pg_dump`:

```bash
pg_dump -U username -d database_name > dump_file.sql
```

#### З інших систем баз даних

Якщо у вас є SQL-дамп з іншої системи баз даних (наприклад, MySQL), вам потрібно вручну перетворити його в синтаксис PostgreSQL перед завантаженням:

1. Замініть специфічний для MySQL синтаксис на еквіваленти PostgreSQL:
   - Замініть ідентифікатори з зворотними лапками (`) на подвійні лапки (")
   - Замініть AUTO_INCREMENT на SERIAL
   - Налаштуйте відмінності типів даних (наприклад, INT на INTEGER)
   - Видаліть специфічні для MySQL інструкції, такі як SET NAMES, SET FOREIGN_KEY_CHECKS тощо.

2. Протестуйте перетворений SQL-дамп у базі даних PostgreSQL перед завантаженням.

## Зразкова база даних електронної комерції

### Огляд

Зразкова база даних представляє вигадану систему електронної комерції з клієнтами, продуктами, замовленнями та співробітниками. Вона включає кілька таблиць з відносинами, зразковими даними та корисними представленнями для аналізу.

### Структура бази даних

#### Таблиці

1. **customers** - Інформація про клієнтів
   - customer_id (PK)
   - first_name, last_name
   - email, phone
   - address, city, country, postal_code
   - registration_date

2. **categories** - Категорії продуктів
   - category_id (PK)
   - category_name
   - description

3. **products** - Інформація про продукти
   - product_id (PK)
   - product_name
   - category_id (FK до categories)
   - price
   - description
   - stock_quantity
   - is_available

4. **orders** - Замовлення клієнтів
   - order_id (PK)
   - customer_id (FK до customers)
   - order_date
   - total_amount
   - status

5. **order_items** - Елементи в замовленнях
   - item_id (PK)
   - order_id (FK до orders)
   - product_id (FK до products)
   - quantity
   - unit_price
   - subtotal (генерований стовпець)

6. **reviews** - Відгуки про продукти від клієнтів
   - review_id (PK)
   - product_id (FK до products)
   - customer_id (FK до customers)
   - rating
   - comment
   - review_date

7. **employees** - Співробітники компанії
   - employee_id (PK)
   - first_name, last_name
   - email
   - hire_date
   - job_title
   - department
   - salary
   - manager_id (самореферентний FK)

#### Представлення

1. **customer_orders_summary** - Зведення замовлень клієнтів
2. **product_sales_summary** - Зведення продажів продуктів
3. **employee_hierarchy** - Ієрархічне представлення співробітників

### Приклади запитів

Ви можете виконати різні запити для вивчення бази даних, від базових SELECT до складних з'єднань, агрегацій та рекурсивних запитів. Детальні приклади запитів доступні в SQL редакторі.

## Додавання зразкової бази даних до SQL редактора

### Кроки для додавання зразкової бази даних

1. Файл SQL зразкової бази даних (`sample_database.sql`) розміщений у директорії `backend/media/teacher_dumps`.

2. Щоб зробити цю базу даних доступною в SQL редакторі, вам потрібно створити запис у моделі TeacherDatabase. Ви можете зробити це одним із двох способів:

#### Варіант 1: Використання інтерфейсу адміністратора Django

1. Увійдіть в інтерфейс адміністратора Django (http://localhost:8000/admin/) з обліковим записом адміністратора.
2. Перейдіть до розділу "Teacher databases".
3. Натисніть "Add teacher database".
4. Заповніть наступні деталі:
   - Name: "Sample E-commerce Database"
   - Teacher: Виберіть обліковий запис викладача
   - SQL dump: Виберіть файл `sample_database.sql` з вибору файлів
5. Натисніть "Save".

#### Варіант 2: Використання сторінки завантаження бази даних викладача

1. Увійдіть в додаток з обліковим записом викладача.
2. Перейдіть на сторінку "Upload Database" з бічної панелі.
3. Заповніть наступні деталі:
   - Name: "Sample E-commerce Database"
   - SQL dump: Завантажте файл `sample_database.sql`
4. Натисніть "Upload".

### Перевірка бази даних

Після додавання бази даних ви можете перевірити, чи вона доступна в SQL редакторі:

1. Перейдіть на сторінку SQL редактора.
2. У випадаючому списку "Select Database" ви повинні побачити опцію "Sample E-commerce Database".
3. Виберіть її та перевірте, чи з'являються таблиці в лівій бічній панелі.
4. Спробуйте виконати деякі з прикладів запитів, щоб перевірити, чи вона працює правильно.